<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>NHS Wales Solutions Exchange</title>
    <meta name="description" content="Discover and share innovative healthcare solutions across NHS Wales organizations">

    <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.0/dist/css/bootstrap.min.css" rel="stylesheet">
    <script src="https://code.jquery.com/jquery-3.6.0.min.js"></script>
    <script src="https://cdn.jsdelivr.net/npm/bootstrap@5.3.0/dist/js/bootstrap.bundle.min.js"></script>
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.0.0/css/all.min.css">
    <link rel="stylesheet" href="css/style.css">
</head>
<body>
    <nav class="navbar fixed-top navbar-expand-lg navbar-dark">
        <div class="container-fluid">
            <a class="navbar-brand" href="#">
                <i class="fas fa-exchange-alt me-2"></i>
                NHS Wales Solutions Exchange
            </a>
            <button class="navbar-toggler" type="button" data-bs-toggle="collapse" data-bs-target="#navbarNav" aria-controls="navbarNav" aria-expanded="false" aria-label="Toggle navigation">
                <span class="navbar-toggler-icon"></span>
            </button>
            <div class="collapse navbar-collapse" id="navbarNav">
                <ul class="navbar-nav me-auto">
                    <li class="nav-item">
                        <a class="nav-link active" href="#"><i class="fas fa-home me-1"></i>Home</a>
                    </li>
                    <li class="nav-item">
                        <a class="nav-link" href="https://github.com/GIGCymru/GitHub-GIG-Cymru/wiki"><i class="fas fa-book me-1"></i>Documentation</a>
                    </li>
                    <li class="nav-item">
                        <a class="nav-link" href="https://github.com/GIGCymru/GitHub-GIG-Cymru-FAQ"><i class="fas fa-question-circle me-1"></i>FAQs</a>
                    </li>
                </ul>
                <ul class="navbar-nav">
                    <li class="nav-item">
                        <a class="nav-link" href="#"><i class="fas fa-plus-circle me-1"></i>Submit Solution</a>
                    </li>
                </ul>
            </div>
        </div>
    </nav>
    
    <script>
        document.body.className = document.body.className
            ? document.body.className + " js-enabled"
            : "js-enabled";
    </script>

    <div class="main-container">
        <div class="container">
            <div class="page-title">
                <h1><i class="fas fa-lightbulb me-2"></i>Healthcare Solutions Exchange</h1>
            </div>

            <!-- Description Section -->
            <div class="description-section">
                <p class="lead">Welcome to the NHS Wales Solutions Exchange! This platform showcases innovative healthcare solutions, digital tools, and collaborative projects developed across NHS Wales organizations.</p>
                <p>Discover cutting-edge solutions that are improving patient care, enhancing operational efficiency, and driving digital transformation across our healthcare system. Each solution represents the collective expertise and innovation of our dedicated teams working to deliver better health outcomes for the people of Wales.</p>
            </div>

            <!-- Filter Controls -->
            <div class="filter-section">
                <div class="row">
                    <div class="col-md-12">
                        <span class="filter-label"><i class="fas fa-filter me-1"></i>Filter by Project Status:</span>
                        <div class="filter-row">
                            <button class="btn btn-primary me-2" onclick="filterProjects('all')">
                                <i class="fas fa-list me-1"></i>All Solutions
                            </button>
                            <button class="btn btn-secondary me-2" onclick="filterProjects('internal')">
                                <i class="fas fa-lock me-1"></i>Internal
                            </button>
                            <button class="btn btn-success me-2" onclick="filterProjects('public')">
                                <i class="fas fa-globe me-1"></i>Public
                            </button>
                        </div>
                    </div>
                </div>

                <div class="row mt-3">
                    <div class="col-md-6">
                        <span class="filter-label"><i class="fas fa-tags me-1"></i>Filter by Topic:</span>
                        <div id="topicButtons" class="filter-row"></div>
                    </div>
                    <div class="col-md-6">
                        <span class="filter-label"><i class="fas fa-building me-1"></i>Filter by Organisation:</span>
                        <select id="ownerDropdown" class="form-select" onchange="filterByOwner()">
                            <option value="all">All Organisations</option>
                        </select>
                    </div>
                </div>
            </div>

            <!-- Results Summary -->
            <div id="resultsSummary" class="mb-3">
                <small class="text-muted">Loading solutions...</small>
            </div>

            <!-- Solutions Grid -->
            <div id="jsonData" class="row"></div>
        </div>
    </div>

                <script>
                    // Global variable to store loaded data
                    let repositories = [];
                    let currentFilters = {
                        status: 'all',
                        topic: null,
                        owner: 'all'
                    };

                    // Function to load JSON and render topics, owners, and project cards
                    function loadJSON() {
                        fetch('repositories.json')
                            .then(response => {
                                if (!response.ok) {
                                    throw new Error('Failed to load data');
                                }
                                return response.json();
                            })
                            .then(data => {
                                repositories = data;
                                renderProjects(data);
                                renderTopicButtons(data);
                                renderOwnerDropdown(data);
                                updateResultsSummary(data);
                            })
                            .catch(error => {
                                console.error('Error loading JSON:', error);
                                document.getElementById('jsonData').innerHTML = 
                                    '<div class="no-results"><i class="fas fa-exclamation-triangle"></i><h4>Unable to load solutions</h4><p>Please try again later or contact support.</p></div>';
                            });
                    }

                    // Function to filter projects based on status
                    function filterProjects(status) {
                        currentFilters.status = status;
                        applyFilters();
                        
                        // Update button states
                        document.querySelectorAll('.filter-section .btn').forEach(btn => {
                            btn.classList.remove('active');
                        });
                        event.target.classList.add('active');
                    }

                    // Function to apply all current filters
                    function applyFilters() {
                        let filtered = repositories;
                        
                        // Filter by status
                        if (currentFilters.status !== 'all') {
                            filtered = filtered.filter(repo => 
                                currentFilters.status === 'internal' ? repo.visibility === 'internal' : repo.visibility === 'public'
                            );
                        }
                        
                        // Filter by topic
                        if (currentFilters.topic) {
                            filtered = filtered.filter(repo => repo.topics && repo.topics.includes(currentFilters.topic));
                        }
                        
                        // Filter by owner
                        if (currentFilters.owner !== 'all') {
                            filtered = filtered.filter(repo => repo.owner.login === currentFilters.owner);
                        }
                        
                        renderProjects(filtered);
                        updateResultsSummary(filtered);
                    }

                    // Function to render project cards with improved design
                    function renderProjects(data) {
                        const jsonDataDiv = document.getElementById('jsonData');
                        
                        if (data.length === 0) {
                            jsonDataDiv.innerHTML = '<div class="no-results"><i class="fas fa-search"></i><h4>No solutions found</h4><p>Try adjusting your filters to see more results.</p></div>';
                            return;
                        }
                        
                        jsonDataDiv.innerHTML = data.map(repo => `
                            <div class="col-lg-6 col-xl-4 mb-4">
                                <div class="card solution-card h-100">
                                    <div class="card-header-custom">
                                        <h5 class="card-title mb-0">
                                            <a href="${repo.html_url}" target="_blank" rel="noopener noreferrer">
                                                <i class="fas fa-code me-2"></i>${repo.name}
                                            </a>
                                        </h5>
                                    </div>
                                    <div class="card-body">
                                        <p class="card-text">${repo.description || 'No description provided'}</p>
                                        ${repo.topics && repo.topics.length > 0 ? 
                                            `<div class="mb-3">
                                                ${repo.topics.map(topic => `<span class="topic-tag" onclick="filterByTopic('${topic}')">${topic}</span>`).join('')}
                                            </div>` : ''
                                        }
                                    </div>
                                    <div class="solution-meta">
                                        <div class="meta-item">
                                            <span class="meta-label"><i class="fas fa-building me-1"></i>Organisation:</span>
                                            <span class="meta-value">
                                                <a href="${repo.owner.html_url}" target="_blank" rel="noopener noreferrer">${repo.owner.login}</a>
                                            </span>
                                        </div>
                                        <div class="meta-item">
                                            <span class="meta-label"><i class="fas fa-code me-1"></i>Language:</span>
                                            <span class="meta-value">${repo.language || 'Not specified'}</span>
                                        </div>
                                        <div class="meta-item">
                                            <span class="meta-label"><i class="fas fa-eye me-1"></i>Status:</span>
                                            <span class="status-badge ${repo.visibility === 'internal' ? 'status-internal' : 'status-public'}">
                                                <i class="fas ${repo.visibility === 'internal' ? 'fa-lock' : 'fa-globe'} me-1"></i>
                                                ${repo.visibility === 'internal' ? 'Internal' : 'Public'}
                                            </span>
                                        </div>
                                        <div class="meta-item">
                                            <span class="meta-label"><i class="fas fa-calendar me-1"></i>Updated:</span>
                                            <span class="meta-value">${new Date(repo.updated_at).toLocaleDateString()}</span>
                                        </div>
                                    </div>
                                </div>
                            </div>
                        `).join('');
                    }

                    // Function to render buttons for topics
                    function renderTopicButtons(data) {
                        const allTopics = [...new Set(data.flatMap(repo => repo.topics || []))].sort();
                        const topicButtonsDiv = document.getElementById('topicButtons');
                        topicButtonsDiv.innerHTML = `
                            <button class="btn btn-outline-info ${!currentFilters.topic ? 'active' : ''}" onclick="clearTopicFilter()">
                                <i class="fas fa-times me-1"></i>All Topics
                            </button>
                            ${allTopics.map(topic => `
                                <button class="btn btn-outline-info ${currentFilters.topic === topic ? 'active' : ''}" onclick="filterByTopic('${topic}')">
                                    ${topic}
                                </button>
                            `).join('')}
                        `;
                    }

                    // Function to filter projects by topic
                    function filterByTopic(topic) {
                        currentFilters.topic = topic;
                        applyFilters();
                        renderTopicButtons(repositories);
                    }

                    // Function to clear topic filter
                    function clearTopicFilter() {
                        currentFilters.topic = null;
                        applyFilters();
                        renderTopicButtons(repositories);
                    }

                    // Function to render owner dropdown
                    function renderOwnerDropdown(data) {
                        const allOwners = [...new Set(data.map(repo => repo.owner.login))].sort();
                        const ownerDropdown = document.getElementById('ownerDropdown');
                        ownerDropdown.innerHTML = `
                            <option value="all">All Organisations</option>
                            ${allOwners.map(owner => `<option value="${owner}" ${currentFilters.owner === owner ? 'selected' : ''}>${owner}</option>`).join('')}
                        `;
                    }

                    // Function to filter projects by owner
                    function filterByOwner() {
                        const selectedOwner = document.getElementById('ownerDropdown').value;
                        currentFilters.owner = selectedOwner;
                        applyFilters();
                    }

                    // Function to update results summary
                    function updateResultsSummary(data) {
                        const summaryDiv = document.getElementById('resultsSummary');
                        const total = repositories.length;
                        const filtered = data.length;
                        
                        if (filtered === total) {
                            summaryDiv.innerHTML = `<small class="text-muted">Showing all ${total} solutions</small>`;
                        } else {
                            summaryDiv.innerHTML = `<small class="text-muted">Showing ${filtered} of ${total} solutions</small>`;
                        }
                    }

                    // Initialize on page load
                    window.onload = loadJSON;
                </script>
            </div>
        </main>
    </div>
</body>
</html>

