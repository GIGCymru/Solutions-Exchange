<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>NHS Wales Solutions Exchange - Home</title>
    <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.0/dist/css/bootstrap.min.css" rel="stylesheet">
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.0/css/all.min.css">
    <link rel="stylesheet" href="css/style.css">
    
    <style>
        .featured-card {
            border: 2px solid #ffc107 !important;
            position: relative;
        }
        
        .featured-card .card-img-top {
            width: 100%;
            height: 180px;
            object-fit: contain;
            object-position: center;
            background: #f8f9fa;
            border-radius: 0.5rem 0.5rem 0 0;
            aspect-ratio: 16/9;
            display: block;
        }
        
        .success-story img {
            width: 100%;
            height: 120px;
            object-fit: contain;
            object-position: center;
            background: #f8f9fa;
            border-radius: 0.5rem;
            aspect-ratio: 16/9;
            display: block;
        }
        
        .featured-card::before {
            content: '★ FEATURED';
            position: absolute;
            top: 10px;
            right: 10px;
            background: #ffc107;
            color: #000;
            padding: 2px 8px;
            border-radius: 4px;
            font-size: 0.7rem;
            font-weight: bold;
            z-index: 10;
        }

        #recently-updated .card {
            transition: transform 0.2s ease-in-out, box-shadow 0.2s ease-in-out;
        }
        
        #recently-updated .card:hover {
            transform: translateY(-2px);
            box-shadow: 0 4px 12px rgba(0,0,0,0.15);
        }

        #recently-updated .border-start.border-primary {
            border-width: 4px !important;
        }
    </style>
</head>
<body>

    <!-- Navigation -->
    <nav class="navbar navbar-expand-lg navbar-light bg-light">
        <div class="container">
            <a class="navbar-brand" href="index.html">
                <img src="assets/img/171259-nhs-logo-blue.png" alt="NHS Wales Logo" style="height: 40px;">
                <span class="ms-2">GitHub GIG Cymru: Solutions Exchange</span>
            </a>
            <button class="navbar-toggler" type="button" data-bs-toggle="collapse" data-bs-target="#navbarNav">
                <span class="navbar-toggler-icon"></span>
            </button>
            <div class="collapse navbar-collapse" id="navbarNav">
                <ul class="navbar-nav ms-auto">
                    <li class="nav-item"><a class="nav-link active" href="index.html">Home</a></li>
                    <li class="nav-item"><a class="nav-link" href="solutions.html">Solutions Exchange</a></li>
                    <li class="nav-item"><a class="nav-link" href="service-metrics.html">Service Metrics</a></li>
                    <li class="nav-item"><a class="nav-link" href="guides.html">Guides</a></li>
                    <li class="nav-item"><a class="nav-link btn btn-primary text-white ms-2 px-3" href="guides.html#signup">Sign Up</a></li>
                    <li class="nav-item dropdown ms-2">
                        <a class="nav-link dropdown-toggle" href="#" id="languageDropdown" role="button" data-bs-toggle="dropdown" aria-expanded="false">
                            <i class="fas fa-globe"></i> EN
                        </a>
                        <ul class="dropdown-menu" aria-labelledby="languageDropdown">
                            <li><a class="dropdown-item" href="#" onclick="setLanguage('en')">English</a></li>
                            <li><a class="dropdown-item" href="#" onclick="setLanguage('cy')">Cymraeg</a></li>
                        </ul>
                    </li>
                </ul>
            </div>
        </div>
    </nav>

    <!-- Hero Section -->
    <header class="hero-section text-white text-center">
        <div class="container">
            <h1 class="display-4">Explore NHS Wales Repositories</h1>
            <p class="lead">Access our comprehensive collection of NHS Wales projects and code, complete with user guides and training resources to support your work.</p>
            <a href="solutions.html" class="btn btn-primary btn-lg">View Projects & Code</a>
        </div>
    </header>

    <!-- Statistics Section -->
    <section id="statistics" class="py-5 bg-light">
        <div class="container">
            <h2 class="text-center mb-4">Solutions by Wales for everyone.</h2>
            <div id="metrics" class="row text-center">
                <!-- Metrics will be loaded here -->
            </div>
        </div>
    </section>

    <!-- Success Stories Section -->
    <section id="success-stories" class="py-5">
        <div class="container">
            <h2 class="text-center mb-5">Success Stories</h2>
            <div class="row">
                <div class="col-lg-8 mx-auto">
                    <div id="successStoriesContainer">
                        <!-- Success stories will be loaded here dynamically -->
                    </div>
                    <div class="text-center mt-4">
                        <a href="https://dhcw.nhs.wales/news/latest-news/category/dhcw-news/ndr/" class="btn btn-outline-primary">Read More Success Stories</a>
                    </div>
                </div>
            </div>
        </div>
    </section>

    <!-- Featured Solutions Section -->
    <section class="featured-solutions py-5 bg-light mt-5">
        <div class="container">
            <div class="d-flex justify-content-between align-items-center mb-5">
                <h2>Featured Solutions</h2>
                <small class="text-muted">
                    <i class="fas fa-star me-1"></i>
                    Automatically selected based on quality criteria
                </small>
            </div>
            
            <div id="featuredSolutionsList" class="row">
                <!-- Featured solutions will be loaded here dynamically -->
            </div>
            
            <!-- Fallback content if no featured solutions qualify -->
            <div id="featuredFallback" class="row" style="display: none;">
                <div class="col-md-4 mb-4">
                    <div class="card h-100 featured-card">
                        <img src="assets/img/information.jpg" class="card-img-top" alt="ED Analysis Forecast">
                        <div class="card-body">
                            <h5 class="card-title">ED Analysis Forecast</h5>
                            <p class="card-text">Advanced emergency department forecasting tools to predict patient flow and optimize resource allocation.</p>
                        </div>
                    </div>
                </div>
                <div class="col-md-4 mb-4">
                    <div class="card h-100 featured-card">
                        <img src="assets/img/network image.jpg" class="card-img-top" alt="Data Analytics Platform">
                        <div class="card-body">
                            <h5 class="card-title">Data Analytics Platform</h5>
                            <p class="card-text">Comprehensive analytics solution for healthcare data processing and visualization.</p>
                        </div>
                    </div>
                </div>
                <div class="col-md-4 mb-4">
                    <div class="card h-100 featured-card">
                        <img src="assets/img/information.jpg" class="card-img-top" alt="Clinical Decision Support">
                        <div class="card-body">
                            <h5 class="card-title">Clinical Decision Support</h5>
                            <p class="card-text">AI-powered tools to assist healthcare professionals in making informed clinical decisions.</p>
                        </div>
                    </div>
                </div>
            </div>
        </div>
    </section>

    <!-- User Feedback Section -->
    <section id="user-feedback" class="py-5">
        <div class="container">
            <h2 class="text-center mb-5">User Feedback</h2>
            <div class="row">
                <div class="col-md-4 mb-4">
                    <div class="card h-100 testimonial-card">
                        <div class="card-body text-center">
                            <div class="mb-3">
                                <img src="assets/img/nhs_wales_logo.png" alt="Rebecca" class="rounded-circle testimonial-avatar" style="width: 60px; height: 60px; object-fit: cover;">
                            </div>
                            <blockquote class="blockquote">
                                <p>“To be able to share and test code changes before deployment.
This is the future of collaborative working and code management.”</p>
                            </blockquote>
                            <footer class="blockquote-footer">
                                <small class="text-muted">Aneurin Bevan UHB</small>
                            </footer>
                        </div>
                    </div>
                </div>
                <div class="col-md-4 mb-4">
                    <div class="card h-100 testimonial-card">
                        <div class="card-body text-center">
                            <div class="mb-3">
                                <img src="assets/img/nhs_wales_logo.png" alt="Jason" class="rounded-circle testimonial-avatar" style="width: 60px; height: 60px; object-fit: cover;">
                            </div>
                            <blockquote class="blockquote">
                                <p>“Everything GitHub provides. Can’t think of anything that GitHub doesn’t already do.”</p>
                            </blockquote>
                            <footer class="blockquote-footer">
                                <small class="text-muted">Swansea Bay Univeristy Health Board</small>
                            </footer>
                        </div>
                    </div>
                </div>
                <div class="col-md-4 mb-4">
                    <div class="card h-100 testimonial-card">
                        <div class="card-body text-center">
                            <div class="mb-3">
                                <img src="assets/img/nhs_wales_logo.png" alt="Cerys" class="rounded-circle testimonial-avatar" style="width: 60px; height: 60px; object-fit: cover;">
                            </div>
                            <blockquote class="blockquote">
                                <p>“To do analysis-as-code without proper version control is unwise and goes against standard software development principles.”</p>
                            </blockquote>
                            <footer class="blockquote-footer">
                                <small class="text-muted">Public Health Wales</small>
                            </footer>
                        </div>
                    </div>
                </div>
            </div>
        </div>
    </section>

    <!-- Recently Updated Section -->
    <section id="recently-updated" class="py-5">
        <div class="container">
            <div class="d-flex justify-content-between align-items-center mb-5">
                <h2>Recently Updated</h2>
                <small class="text-muted">
                    <i class="fas fa-clock me-1"></i>
                    Latest activity across NHS Wales repositories
                </small>
            </div>
            
            <div id="recentlyUpdatedList" class="row">
                <!-- Recently updated solutions will be loaded here dynamically -->
            </div>
            
            <div class="text-center mt-4">
                <a href="solutions.html?sort=updated" class="btn btn-outline-primary">
                    <i class="fas fa-history me-2"></i>View All Recent Updates
                </a>
            </div>
        </div>
    </section>

    <!-- How to Contribute -->
    <section id="contribute" class="py-5 bg-light">
        <div class="container text-center">
            <h2>Join the Collaboration Movement</h2>
            <p class="lead">Help us build the future of digital health in Wales by collaborating across organisations.</p>
            <div class="row justify-content-center">
                <div class="col-md-8">
                    <div class="row">
                        <div class="col-md-6 mb-3">

                            <a href="guides.html#signup" class="btn btn-success btn-lg w-100">
                                <i class="fas fa-user-plus me-2"></i>Join the Collaboration Movement

                            </a>
                        </div>
                        <div class="col-md-6 mb-3">
                            <a href="guides.html" class="btn btn-outline-primary btn-lg w-100">
                                <i class="fas fa-book me-2"></i>Read the Guides
                            </a>
                        </div>
                    </div>
                    <div class="row">
                        <div class="col-md-6 mb-3">
                            <a href="solutions.html" class="btn btn-outline-secondary btn-lg w-100">
                                <i class="fas fa-search me-2"></i>Browse Solutions
                            </a>
                        </div>
                        <div class="col-md-6 mb-3">
                            <a href="https://github.com/GIGCymru" target="_blank" class="btn btn-outline-info btn-lg w-100">
                                <i class="fab fa-github me-2"></i>Visit GitHub
                            </a>
                        </div>
                    </div>
                </div>
            </div>
        </div>
    </section>

    <!-- Health Boards Carousel Section -->
    <section class="health-boards-carousel py-5 bg-white">
        <div class="container">
            <h2 class="text-center mb-5">Explore Health Board Solutions</h2>
            <p class="text-center text-muted mb-4">Discover innovative solutions from across NHS Wales health boards and organisations</p>
            
            <div id="healthBoardsCarousel" class="carousel slide" data-bs-ride="carousel" data-bs-interval="4000">
                <div class="carousel-indicators">
                    <button type="button" data-bs-target="#healthBoardsCarousel" data-bs-slide-to="0" class="active"></button>
                    <button type="button" data-bs-target="#healthBoardsCarousel" data-bs-slide-to="1"></button>
                    <button type="button" data-bs-target="#healthBoardsCarousel" data-bs-slide-to="2"></button>
                </div>
                
                <div class="carousel-inner">
                    <!-- Slide 1: Major Health Boards -->
                    <div class="carousel-item active">
                        <div class="row justify-content-center">
                            <div class="col-md-4 mb-4">
                                <div class="health-board-card text-center p-4">
                                    <div class="health-board-icon mb-3">
                                        <img src="assets/img/171290-cardiff-_-vale_univerisity-health-board_outlined.jpg" alt="Cardiff and Vale UHB" style="height: 60px; object-fit: contain;">
                                    </div>
                                    <h5>Cardiff and Vale UHB</h5>
                                    <p class="text-muted">Serving Cardiff, Vale of Glamorgan and beyond with innovative healthcare solutions</p>
                                    <a href="solutions.html?org=Cardiff" class="btn btn-outline-primary">
                                        <i class="fab fa-github me-2"></i>View Solutions
                                    </a>
                                </div>
                            </div>
                            <div class="col-md-4 mb-4">
                                <div class="health-board-card text-center p-4">
                                    <div class="health-board-icon mb-3">
                                        <img src="assets/img/171279-abertawe_swansea-nhs-health-board.jpg" alt="Swansea Bay UHB" style="height: 60px; object-fit: contain;">
                                    </div>
                                    <h5>Swansea Bay UHB</h5>
                                    <p class="text-muted">Leading digital health innovation across Swansea Bay region</p>
                                    <a href="solutions.html?org=SwanseaBayUHB" class="btn btn-outline-primary">
                                        <i class="fab fa-github me-2"></i>View Solutions
                                    </a>
                                </div>
                            </div>
                            <div class="col-md-4 mb-4">
                                <div class="health-board-card text-center p-4">
                                    <div class="health-board-icon mb-3">
                                        <img src="assets/img/171269-aneurin-bevan_univerisity-health-board_outlined.jpg" alt="Aneurin Bevan UHB" style="height: 60px; object-fit: contain;">
                                    </div>
                                    <h5>Aneurin Bevan UHB</h5>
                                    <p class="text-muted">Transforming healthcare delivery in Gwent with cutting-edge technology</p>
                                    <a href="solutions.html?org=AneurinBevanUHB" class="btn btn-outline-primary">
                                        <i class="fab fa-github me-2"></i>View Solutions
                                    </a>
                                </div>
                            </div>
                                    </a>
                                </div>
                            </div>
                            <div class="col-md-4 mb-4">
                                <div class="health-board-card text-center p-4">
                                    <div class="health-board-icon mb-3">
                                        <img src="assets/img/171279-abertawe_swansea-nhs-health-board.jpg" alt="Swansea Bay UHB" style="height: 60px; object-fit: contain;">
                                    </div>
                                    <h5>Swansea Bay UHB</h5>
                                    <p class="text-muted">Leading digital health innovation across Swansea Bay region</p>
                                    <a href="solutions.html?org=Swansea" class="btn btn-outline-primary">
                                        <i class="fab fa-github me-2"></i>View Solutions
                                    </a>
                                </div>
                            </div>
                            <div class="col-md-4 mb-4">
                                <div class="health-board-card text-center p-4">
                                    <div class="health-board-icon mb-3">
                                        <img src="assets/img/171269-aneurin-bevan_univerisity-health-board_outlined.jpg" alt="Aneurin Bevan UHB" style="height: 60px; object-fit: contain;">
                                    </div>
                                    <h5>Aneurin Bevan UHB</h5>
                                    <p class="text-muted">Transforming healthcare delivery in Gwent with cutting-edge technology</p>
                                    <a href="solutions.html?org=AneurinBevan" class="btn btn-outline-primary">
                                        <i class="fab fa-github me-2"></i>View Solutions
                                    </a>
                                </div>
                            </div>
                        </div>
                    </div>
                    
                    <!-- Slide 2: Regional Health Boards -->
                    <div class="carousel-item">
                        <div class="row justify-content-center">
                            <div class="col-md-4 mb-4">
                                <div class="health-board-card text-center p-4">
                                    <div class="health-board-icon mb-3">
                                        <img src="assets/img/171282-betsi-cadwaladr_univerisity-health-board_outlined.jpg" alt="Betsi Cadwaladr UHB" style="height: 60px; object-fit: contain;">
                                    </div>
                                    <h5>Betsi Cadwaladr UHB</h5>
                                    <p class="text-muted">Comprehensive healthcare solutions across North Wales</p>
                                    <a href="solutions.html?org=BetsiCadwaladr" class="btn btn-outline-primary">
                                        <i class="fab fa-github me-2"></i>View Solutions
                                    </a>
                                </div>
                            </div>
                            <div class="col-md-4 mb-4">
                                <div class="health-board-card text-center p-4">
                                    <div class="health-board-icon mb-3">
                                        <img src="assets/img/171302-cwm-taf_university-health-board-updated.jpg" alt="Cwm Taf Morgannwg UHB" style="height: 60px; object-fit: contain;">
                                    </div>
                                    <h5>Cwm Taf Morgannwg UHB</h5>
                                    <p class="text-muted">Digital health solutions for the valleys and surrounding communities</p>
                                    <a href="solutions.html?org=CwmTafUHB" class="btn btn-outline-primary">
                                        <i class="fab fa-github me-2"></i>View Solutions
                                    </a>
                                </div>
                            </div>
                            <div class="col-md-4 mb-4">
                                <div class="health-board-card text-center p-4">
                                    <div class="health-board-icon mb-3">
                                        <img src="assets/img/171309-hywel-dda.jpg" alt="Hywel Dda UHB" style="height: 60px; object-fit: contain;">
                                    </div>
                                    <h5>Hywel Dda UHB</h5>
                                    <p class="text-muted">Healthcare innovation across West Wales communities</p>
                                    <a href="solutions.html?org=HywelDdaUHB" class="btn btn-outline-primary">
                                        <i class="fab fa-github me-2"></i>View Solutions
                                    </a>
                                </div>
                            </div>
                                    </a>
                                </div>
                            </div>
                            <div class="col-md-4 mb-4">
                                <div class="health-board-card text-center p-4">
                                    <div class="health-board-icon mb-3">
                                        <img src="assets/img/171302-cwm-taf_university-health-board-updated.jpg" alt="Cwm Taf Morgannwg UHB" style="height: 60px; object-fit: contain;">
                                    </div>
                                    <h5>Cwm Taf Morgannwg UHB</h5>
                                    <p class="text-muted">Digital health solutions for the valleys and surrounding communities</p>
                                    <a href="solutions.html?org=CwmTaf" class="btn btn-outline-primary">
                                        <i class="fab fa-github me-2"></i>View Solutions
                                    </a>
                                </div>
                            </div>
                            <div class="col-md-4 mb-4">
                                <div class="health-board-card text-center p-4">
                                    <div class="health-board-icon mb-3">
                                        <img src="assets/img/171309-hywel-dda.jpg" alt="Hywel Dda UHB" style="height: 60px; object-fit: contain;">
                                    </div>
                                    <h5>Hywel Dda UHB</h5>
                                    <p class="text-muted">Healthcare innovation across West Wales communities</p>
                                    <a href="solutions.html?org=HywelDda" class="btn btn-outline-primary">
                                        <i class="fab fa-github me-2"></i>View Solutions
                                    </a>
                                </div>
                            </div>
                        </div>
                    </div>
                    
                    <!-- Slide 3: National organisations -->
                    <div class="carousel-item">
                        <div class="row justify-content-center">
                            <div class="col-md-4 mb-4">
                                <div class="health-board-card text-center p-4">
                                    <div class="health-board-icon mb-3">
                                        <img src="assets/img/171315-powys-teaching_hb-logo.jpg" alt="Powys Teaching Health Board" style="height: 60px; object-fit: contain;">
                                    </div>
                                    <h5>Powys Teaching Health Board</h5>
                                    <p class="text-muted">Rural healthcare solutions and community-focused innovations</p>
                                    <a href="solutions.html?org=Powys" class="btn btn-outline-primary">
                                        <i class="fab fa-github me-2"></i>View Solutions
                                    </a>
                                </div>
                            </div>
                            <div class="col-md-4 mb-4">
                                <div class="health-board-card text-center p-4">
                                    <div class="health-board-icon mb-3">
                                        <i class="fas fa-code text-dark" style="font-size: 3rem;"></i>
                                    </div>
                                    <h5>Digital Health and Care Wales</h5>
                                    <p class="text-muted">National digital transformation and infrastructure solutions</p>
                                    <a href="solutions.html?org=DHCW" class="btn btn-outline-primary">
                                        <i class="fab fa-github me-2"></i>View Solutions
                                    </a>
                                </div>
                            </div>
                                    </a>
                                </div>
                            </div>
                            <div class="col-md-4 mb-4">
                                <div class="health-board-card text-center p-4">
                                    <div class="health-board-icon mb-3">
                                        <i class="fas fa-code text-dark" style="font-size: 3rem;"></i>
                                    </div>
                                    <h5>Digital Health and Care Wales</h5>
                                    <p class="text-muted">National digital transformation and infrastructure solutions</p>
                                    <a href="solutions.html?org=DHCW" class="btn btn-outline-primary">
                                        <i class="fab fa-github me-2"></i>View Solutions
                                    </a>
                                </div>
                            </div>
                            <div class="col-md-4 mb-4">
                                <div class="health-board-card text-center p-4">
                                    <div class="health-board-icon mb-3">
                                        <i class="fab fa-github text-secondary" style="font-size: 3rem;"></i>
                                    </div>
                                    <h5>GitHub GIG Cymru</h5>
                                    <p class="text-muted">Open source collaboration hub for Welsh healthcare innovation</p>
                                    <a href="https://github.com/GIGCymru" target="_blank" class="btn btn-outline-primary">
                                        <i class="fab fa-github me-2"></i>Visit GitHub
                                    </a>
                                </div>
                            </div>
                        </div>
                    </div>
                </div>
                
                <button class="carousel-control-prev" type="button" data-bs-target="#healthBoardsCarousel" data-bs-slide="prev">
                    <span class="carousel-control-prev-icon" aria-hidden="true"></span>
                    <span class="visually-hidden">Previous</span>
                </button>
                <button class="carousel-control-next" type="button" data-bs-target="#healthBoardsCarousel" data-bs-slide="next">
                    <span class="carousel-control-next-icon" aria-hidden="true"></span>
                    <span class="visually-hidden">Next</span>
                </button>
            </div>
        </div>
    </section>

    

    <!-- Footer -->
    <footer>
        <div class="container">
            <div class="d-flex footer-navbar col-12">
                <div class="col-lg-12 mb-12 p-2 flex-fill footer-logo">
                    <img class="nav-large-image" src="assets/img/171259-nhs-logo-blue.png" alt="NHS Wales | GIG CYMRU Logo">
                </div>
                
                <section class="p-2 flex-fill footer-section">
                    <ul class="justify-content-center">
                        <li><a href="https://dhcw.nhs.wales//use-of-site/accessibility/" class="nav-link" target="_self">Accessibility statement</a></li>
                            
                                <li><a href="https://dhcw.nhs.wales//use-of-site/terms-of-use/" class="nav-link" target="_self">Terms of use</a></li>
                            
                                <li><a href="https://dhcw.nhs.wales//use-of-site/freedom-of-information/" class="nav-link" target="_self">Freedom of information</a></li>
                            
                                <li><a href="https://dhcw.nhs.wales//use-of-site/privacy-policy/" class="nav-link" target="_self">Privacy Policy</a></li>
                    </ul>
                </section>
            </div>

            <div class="builtBy">
                Built by <a href="https://dhcw.nhs.wales/our-programmes/national-data-resource1/" target="_self">NDR - National Data Resource</a>
            </div>
        </div>
    </footer>

    <script src="https://cdn.jsdelivr.net/npm/bootstrap@5.3.0/dist/js/bootstrap.bundle.min.js"></script>
    <script>
    // Simple language toggle (placeholder, real implementation would load translations)
    function setLanguage(lang) {
        if (lang === 'cy') {
            alert('Welsh language support coming soon!');
        } else {
            alert('English selected.');
        }
    }
    </script>
    <script>
        // Fetch and display metrics
        async function fetchMetrics() {
            try {
                const response = await fetch('data/repositories.json');
                const repositories = await response.json();
                
                // Load private metrics
                let privateMetrics = null;
                try {
                    const privateResponse = await fetch('data/private_metrics.json');
                    privateMetrics = await privateResponse.json();
                } catch (error) {
                    console.error('Error loading private metrics:', error);
                }
                
                // Calculate real metrics from the data
                const totalSolutions = repositories.length;
                const totalStars = repositories.reduce((sum, repo) => sum + repo.stargazers_count, 0);
                const totalForks = repositories.reduce((sum, repo) => sum + repo.forks_count, 0);
                const organisations = new Set(repositories.map(repo => repo.owner.login));
                const totalOrganisations = organisations.size;
                
                // Calculate additional meaningful metrics
                const activeRepos = repositories.filter(repo => {
                    const lastUpdate = new Date(repo.updated_at);
                    const sixMonthsAgo = new Date();
                    sixMonthsAgo.setMonth(sixMonthsAgo.getMonth() - 6);
                    return lastUpdate > sixMonthsAgo;
                }).length;
                
                const languagesUsed = new Set(
                    repositories
                        .map(repo => repo.language)
                        .filter(lang => lang !== null)
                ).size;
                
                // Calculate total issues and collaborative activity
                const totalIssues = repositories.reduce((sum, repo) => sum + (repo.open_issues_count || 0), 0);
                const collaborativeRepos = repositories.filter(repo => repo.forks_count > 0 || repo.stargazers_count > 0).length;

                // Build metrics HTML with conditional private metrics
                let metricsHtml = `
                    <div class="col-md-3">
                        <a href="solutions.html" class="text-decoration-none">
                            <div class="metric-card" title="Total number of open-source solutions shared on the platform."><h3>${totalSolutions}</h3><p>Open Solutions</p></div>
                        </a>
                    </div>
                `;
                
                // Add private metrics if available
                if (privateMetrics) {
                    metricsHtml += `
                        <div class="col-md-3">
                            <a href="service-metrics.html" class="text-decoration-none">
                                <div class="metric-card" title="Total private repositories accessible through NHS Wales GitHub organizations."><h3>${privateMetrics.private_repos}</h3><p>Private Repositories</p></div>
                            </a>
                        </div>
                    `;
                }
                
                metricsHtml += `
                    <div class="col-md-3">
                        <a href="solutions.html" class="text-decoration-none">
                            <div class="metric-card" title="Number of NHS Wales organisations contributing projects."><h3>${totalOrganisations}</h3><p>NHS Wales Organisations</p></div>
                        </a>
                    </div>
                    <div class="col-md-3">
                        <a href="solutions.html" class="text-decoration-none">
                            <div class="metric-card" title="Projects with recent activity in the last 6 months."><h3>${activeRepos}</h3><p>Active Projects</p></div>
                        </a>
                    </div>
                `;
                
                // Add collaborations only if no private metrics to keep it at 4 cards max
                if (!privateMetrics) {
                    metricsHtml += `
                        <div class="col-md-3">
                            <a href="solutions.html" class="text-decoration-none">
                                <div class="metric-card" title="Projects with collaboration (forks or stars) across organisations."><h3>${collaborativeRepos}</h3><p>Collaborations</p></div>
                            </a>
                        </div>
                    `;
                }
                
                document.getElementById('metrics').innerHTML = metricsHtml;

                // Load featured solutions
                displayFeaturedSolutions(repositories);

                // Load recently updated solutions
                displayRecentlyUpdated(repositories);

            } catch (error) {
                console.error('Error fetching metrics:', error);
                document.getElementById('metrics').innerHTML = '<p class="text-danger">Could not load statistics.</p>';
            }
        }

        // Fetch and display success stories
        async function fetchSuccessStories() {
            try {
                const response = await fetch('data/success_stories.json');
                const successStories = await response.json();
                
                // Display first 3 stories (or all if less than 3)
                const displayStories = successStories.slice(0, 3);
                const container = document.getElementById('successStoriesContainer');
                
                container.innerHTML = displayStories.map(story => `
                    <div class="success-story mb-4">
                        <div class="row align-items-center">
                            <div class="col-md-3">
                                <img src="${story.image}" alt="${story.header}" class="img-fluid rounded">
                            </div>
                            <div class="col-md-9">
                                <h4>
                                    <a href="${story.link}" target="_blank" class="text-decoration-none">
                                        ${story.header}
                                    </a>
                                </h4>
                                <p class="text-muted">${story.description}</p>
                                <div class="mt-2">
                                    <small class="text-primary">
                                        <i class="fas fa-building me-1"></i>
                                        ${story.organization}
                                    </small>
                                    ${story.tags ? story.tags.map(tag => 
                                        `<span class="badge bg-light text-dark ms-1">${tag}</span>`
                                    ).join('') : ''}
                                </div>
                            </div>
                        </div>
                    </div>
                `).join('');

            } catch (error) {
                console.error('Error fetching success stories:', error);
                document.getElementById('successStoriesContainer').innerHTML = 
                    '<p class="text-danger">Could not load success stories.</p>';
            }
        }

        // Display featured solutions based on enhanced data
        function displayFeaturedSolutions(repositories) {
            const featuredContainer = document.getElementById('featuredSolutionsList');
            const fallbackContainer = document.getElementById('featuredFallback');
            // Only feature repos with a meaningful description (at least 30 chars)
            const allFeaturedRepos = repositories.filter(repo => repo.featured === true && repo.description && repo.description.length > 30);
            
            // Shuffle and select 3 random featured solutions
            const shuffledFeatured = allFeaturedRepos.sort(() => 0.5 - Math.random());
            const featuredRepos = shuffledFeatured.slice(0, 3); // Show exactly 3 random featured solutions
            
            if (featuredRepos.length > 0) {
                featuredContainer.innerHTML = featuredRepos.map(repo => createFeaturedCard(repo)).join('');
                featuredContainer.style.display = 'flex';
                fallbackContainer.style.display = 'none';
            } else {
                featuredContainer.style.display = 'none';
                fallbackContainer.style.display = 'flex';
            }
        }

        // Create featured solution card
        function createFeaturedCard(repo) {
            const isPublic = repo.private === false;
            const lastUpdated = new Date(repo.updated_at).toLocaleDateString('en-GB');
            const allTags = repo.all_tags || [...(repo.topics || []), ...(repo.generated_tags || [])];
            const displayTags = allTags.slice(0, 3); // Show first 3 tags
            const qualityScore = repo.quality_score || 0;
            
            // Choose appropriate image based on tags or default
            let cardImage = 'assets/img/information.jpg';
            const tagString = allTags.join(' ').toLowerCase();
            if (tagString.includes('analytics') || tagString.includes('data')) {
                cardImage = 'assets/img/network image.jpg';
            }
            
            return `
                <div class="col-md-4 mb-4">
                    <div class="card h-100 featured-card">
                        <img src="${cardImage}" class="card-img-top" alt="${repo.name}">
                        <div class="card-body">
                            <div class="d-flex justify-content-between align-items-start mb-2">
                                <h5 class="card-title">${repo.name}</h5>
                                <span class="badge ${isPublic ? 'bg-success' : 'bg-primary'} ms-2">
                                    <i class="fas ${isPublic ? 'fa-globe' : 'fa-lock'} me-1"></i>
                                    ${isPublic ? 'PUBLIC' : 'INTERNAL'}
                                </span>
                            </div>
                            
                            <p class="card-text text-muted">
                                ${repo.description || 'NHS Wales healthcare solution providing essential functionality for clinical and administrative workflows.'}
                            </p>
                            
                            <!-- Quality Score -->
                            <div class="mb-2">
                                <span class="badge ${qualityScore >= 80 ? 'bg-success' : qualityScore >= 60 ? 'bg-warning text-dark' : 'bg-secondary'} me-2">
                                    <i class="fas fa-star me-1"></i>
                                    Quality: ${qualityScore}/100
                                </span>
                                <i class="fas fa-crown text-warning" title="Featured Solution"></i>
                            </div>
                            
                            <!-- Tags -->
                            <div class="mb-3">
                                ${displayTags.map(tag => {
                                    const isGenerated = repo.generated_tags && repo.generated_tags.includes(tag);
                                    return `<span class="badge ${isGenerated ? 'bg-info' : 'bg-secondary'} me-1 mb-1" title="${isGenerated ? 'AI-generated tag' : 'User-defined tag'}">${tag}</span>`;
                                }).join('')}
                                ${allTags.length > 3 ? `<span class="badge bg-light text-dark">+${allTags.length - 3} more</span>` : ''}
                            </div>
                            
                            <!-- Organization and Last Updated -->
                            <div class="mb-3">
                                <small class="text-muted d-block">
                                    <i class="fas fa-building me-1"></i>
                                    ${getOrganisationFullName(repo.owner.login)}
                                </small>
                                <small class="text-muted">
                                    <i class="fas fa-clock me-1"></i>
                                    Updated: ${lastUpdated}
                                </small>
                            </div>
                            
                            <!-- Action Buttons -->
                            <div class="mt-auto">
                                <a href="${repo.html_url}" target="_blank" class="btn btn-outline-primary btn-sm">
                                    <i class="fab fa-github me-1"></i>
                                    View Repository
                                </a>
                                ${!isPublic ? `<a href="guides.html#signup" class="btn btn-primary btn-sm ms-2">
                                    <i class="fas fa-lock me-1"></i>
                                    Sign In Required
                                </a>` : ''}
                            </div>
                        </div>
                    </div>
                </div>
            `;
        }

        // Display recently updated solutions
        function displayRecentlyUpdated(repositories) {
            const recentlyUpdatedContainer = document.getElementById('recentlyUpdatedList');
            
            // Sort repositories by updated_at date (most recent first) and take first 6
            const recentRepos = repositories
                .sort((a, b) => new Date(b.updated_at) - new Date(a.updated_at))
                .slice(0, 6);
            
            recentlyUpdatedContainer.innerHTML = recentRepos.map(repo => createRecentlyUpdatedCard(repo)).join('');
        }

        // Create recently updated solution card
        function createRecentlyUpdatedCard(repo) {
            const isPublic = repo.private === false;
            const lastUpdated = new Date(repo.updated_at);
            const timeSinceUpdate = getTimeSinceUpdate(lastUpdated);
            const allTags = repo.all_tags || [...(repo.topics || []), ...(repo.generated_tags || [])];
            const displayTags = allTags.slice(0, 2); // Show first 2 tags for compact display
            
            return `
                <div class="col-md-4 mb-4">
                    <div class="card h-100 border-start border-primary border-3">
                        <div class="card-body">
                            <div class="d-flex justify-content-between align-items-start mb-2">
                                <h6 class="card-title mb-1">
                                    <a href="${repo.html_url}" target="_blank" class="text-decoration-none">
                                        ${repo.name}
                                    </a>
                                </h6>
                                <span class="badge ${isPublic ? 'bg-success' : 'bg-primary'} ms-2">
                                    <i class="fas ${isPublic ? 'fa-globe' : 'fa-lock'} me-1"></i>
                                    ${isPublic ? 'PUBLIC' : 'INTERNAL'}
                                </span>
                            </div>
                            
                            <p class="card-text text-muted small">
                                ${(repo.description || 'NHS Wales healthcare solution providing essential functionality.').substring(0, 120)}${(repo.description || '').length > 120 ? '...' : ''}
                            </p>
                            
                            <!-- Update Info -->
                            <div class="mb-2">
                                <span class="badge bg-info text-white">
                                    <i class="fas fa-clock me-1"></i>
                                    ${timeSinceUpdate}
                                </span>
                                ${repo.featured ? '<i class="fas fa-crown text-warning ms-1" title="Featured Solution"></i>' : ''}
                            </div>
                            
                            <!-- Tags (compact) -->
                            ${displayTags.length > 0 ? `
                            <div class="mb-2">
                                ${displayTags.map(tag => {
                                    const isGenerated = repo.generated_tags && repo.generated_tags.includes(tag);
                                    return `<span class="badge ${isGenerated ? 'bg-light text-dark' : 'bg-secondary'} me-1" style="font-size: 0.7rem">${tag}</span>`;
                                }).join('')}
                                ${allTags.length > 2 ? `<span class="badge bg-light text-dark" style="font-size: 0.7rem">+${allTags.length - 2}</span>` : ''}
                            </div>
                            ` : ''}
                            
                            <!-- Organization -->
                            <small class="text-muted d-block mb-2">
                                <i class="fas fa-building me-1"></i>
                                ${getOrganisationFullName(repo.owner.login)}
                            </small>
                            
                            <!-- Stats -->
                            <div class="d-flex justify-content-between align-items-center">
                                <div>
                                    ${repo.stargazers_count > 0 ? `<small class="text-muted me-2"><i class="fas fa-star me-1"></i>${repo.stargazers_count}</small>` : ''}
                                    ${repo.forks_count > 0 ? `<small class="text-muted"><i class="fas fa-code-branch me-1"></i>${repo.forks_count}</small>` : ''}
                                </div>
                                <a href="${repo.html_url}" target="_blank" class="btn btn-sm btn-outline-primary">
                                    <i class="fab fa-github me-1"></i>
                                    View
                                </a>
                            </div>
                        </div>
                    </div>
                </div>
            `;
        }

        // Helper function to calculate time since update
        function getTimeSinceUpdate(updateDate) {
            const now = new Date();
            const diffTime = Math.abs(now - updateDate);
            const diffDays = Math.floor(diffTime / (1000 * 60 * 60 * 24));
            const diffHours = Math.floor(diffTime / (1000 * 60 * 60));
            const diffMinutes = Math.floor(diffTime / (1000 * 60));
            
            if (diffDays > 30) {
                const months = Math.floor(diffDays / 30);
                return `${months} month${months !== 1 ? 's' : ''} ago`;
            } else if (diffDays > 0) {
                return `${diffDays} day${diffDays !== 1 ? 's' : ''} ago`;
            } else if (diffHours > 0) {
                return `${diffHours} hour${diffHours !== 1 ? 's' : ''} ago`;
            } else if (diffMinutes > 0) {
                return `${diffMinutes} minute${diffMinutes !== 1 ? 's' : ''} ago`;
            } else {
                return 'Just now';
            }
        }

        // Helper function to map organization names
        function getOrganisationFullName(login) {
            const orgMapping = {
                'NHS-Executive': 'NHS Executive',
                'DHCW-Digital-Health-and-Care-Wales': 'Digital Health and Care Wales',
                'GIGCymru': 'GitHub GIG Cymru',
                'NHS-Wales': 'NHS Wales',
                'Betsi-Cadwaladr-UHB': 'Betsi Cadwaladr UHB',
                'Cardiff-and-Vale-UHB': 'Cardiff and Vale UHB',
                'Cwm-Taf-Morgannwg-UHB': 'Cwm Taf Morgannwg UHB',
                'Hywel-Dda-UHB': 'Hywel Dda UHB',
                'Swansea-Bay-UHB': 'Swansea Bay UHB',
                'Aneurin-Bevan-UHB': 'Aneurin Bevan UHB',
                'Powys-Teaching-HB': 'Powys Teaching Health Board'
            };
            return orgMapping[login] || login.replace(/-/g, ' ');
        }

        document.addEventListener('DOMContentLoaded', function() {
            fetchMetrics();
            fetchSuccessStories();
        });
    </script>

</body>
</html>
